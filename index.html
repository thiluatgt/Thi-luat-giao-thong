<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thi Luật Giao Thông</title>
  <link rel="stylesheet" href="style.css">
</head>
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
  authDomain: "thi-luat-giao-thong.firebaseapp.com",
  projectId: "thi-luat-giao-thong",
  storageBucket: "thi-luat-giao-thong.firebasestorage.app",
  messagingSenderId: "173046681456",
  appId: "1:173046681456:web:33da411c508ee243a149b5"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<body>

  <h1>HỆ THỐNG THI LUẬT GIAO THÔNG</h1>

  <div class="box">
    <h2>Đăng nhập học viên</h2>
    <input type="text" id="studentCode" placeholder="Nhập mã học viên">
    <button onclick="loginStudent()">Đăng nhập</button>
  </div>

  <div class="box">
    <h2>Đăng nhập khách</h2>
    <button onclick="loginGuest()">Vào thi với tư cách khách</button>
  </div>

  <script>
function loginStudent() {
  const code = document.getElementById("studentCode").value.trim().toUpperCase();
  if (!code) {
    alert("Vui lòng nhập mã học viên");
    return;
  }

  db.collection("students")
    .where("code", "==", code)
    .get()
    .then(snapshot => {
      if (snapshot.empty) {
        alert("Mã học viên không tồn tại");
        return;
      }

      const student = snapshot.docs[0].data();
      if (student.status !== "Hoạt động") {
        alert("Tài khoản đang bị khóa");
        return;
      }

      localStorage.setItem("userType", "student");
      localStorage.setItem("studentCode", student.code);
      localStorage.setItem("studentName", student.name);

      window.location.href = "exam.html";
    })
    .catch(err => {
      alert("Lỗi kết nối Firebase");
      console.error(err);
    });
}
</script>

    function loginGuest() {
      localStorage.setItem("userType", "guest");
      window.location.href = "exam.html";
    }
  </script>

</body>
</html>
