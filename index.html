<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HỆ THỐNG KIỂM TRA LUẬT GIAO THÔNG</title>

<style>
body{
 margin:0;
 font-family:Arial,Helvetica,sans-serif;
 background:url("background.jpg") center/cover no-repeat fixed;
 min-height:100vh;
 display:flex;
 justify-content:center;
 align-items:center;
}
.loginBox{
 background:rgba(255,255,255,0.95);
 padding:35px 40px;
 border-radius:16px;
 width:360px;
 box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.loginBox h2{
 text-align:center;
 margin-bottom:25px;
 color:#1d3557;
}
.loginBox input{
 width:100%;
 padding:14px;
 font-size:15px;
 border-radius:10px;
 border:1px solid #ccc;
 margin-bottom:18px;
}
.loginBox button{
 width:100%;
 padding:14px;
 font-size:16px;
 border:none;
 border-radius:10px;
 background:#2a9d8f;
 color:white;
 cursor:pointer;
}
.loginBox button:hover{background:#21867a;}
.note{
 margin-top:12px;
 font-size:13px;
 color:#555;
 text-align:center;
}
</style>
</head>

<body>

<div class="loginBox">
 <h2>Đăng nhập học viên</h2>

 <input
  id="studentInput"
  placeholder="Nhập mã hoặc tên học viên (VD: HV001, 001, Nguyễn Văn A)"
  onkeydown="if(event.key==='Enter') studentLogin()"
 >

 <button onclick="studentLogin()">Đăng nhập hệ thống</button>

 <div class="note">
  Có thể nhập <b>mã</b> hoặc <b>tên</b> học viên
 </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain:"thi-luat-giao-thong.firebaseapp.com",
 projectId:"thi-luat-giao-thong"
});
const db = firebase.firestore();

/* ===== LOGIN FUNCTION ===== */
function studentLogin(){
 const input = document.getElementById("studentInput").value.trim();
 if(!input){
  alert("Vui lòng nhập mã hoặc tên học viên");
  return;
 }

 let query = db.collection("students");

 /* ==== NHẬP MÃ ==== */
 if(/\d/.test(input)){
  const digits = input.replace(/\D/g,"");
  if(digits){
   const code = digits.padStart(3,"0");
   query = query.where("code","==",code);
  }
 }

 /* ==== NHẬP TÊN ==== */
 else{
  const nameLower = input.toLowerCase();
  query = query.where("name_lower","==",nameLower);
 }

 query.limit(1).get().then(snap=>{
  if(snap.empty){
   alert("❌ Không tìm thấy học viên");
   return;
  }

  const student = snap.docs[0].data();

  /* ===== LƯU ĐÚNG – DUY NHẤT ===== */
  localStorage.clear();
  localStorage.setItem("userType","student");
  localStorage.setItem("studentCode", student.code); // <<< CHỈ LƯU CODE

  location.href="exam.html";
 });
}
</script>

</body>
</html>
