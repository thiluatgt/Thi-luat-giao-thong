<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜</title>

<style>
body{
 margin:0;font-family:Arial;
 background:url("https://i.imgur.com/1ZQZ1Zm.jpg") center/cover no-repeat;
 min-height:100vh;
 display:flex;align-items:center;justify-content:center;
}
#loginBox{
 width:420px;background:rgba(255,255,255,.95);
 padding:30px;border-radius:12px;
 box-shadow:0 10px 30px rgba(0,0,0,.25);
}
h2{text-align:center;color:#1d3557;}
input{
 width:100%;padding:12px;font-size:16px;
 margin-top:15px;border-radius:6px;
 border:1px solid #ccc;
}
button{
 width:100%;padding:14px;font-size:17px;
 border:none;border-radius:8px;
 cursor:pointer;margin-top:15px;
}
#loginBtn{background:#1d3557;color:white;}
#guestBtn{background:#457b9d;color:white;}
.note{
 margin-top:20px;font-size:14px;color:#444;
 text-align:center;
}
</style>
</head>

<body>

<div id="loginBox">
 <h2>KIá»‚M TRA LUáº¬T GIAO THÃ”NG<br>ÄÆ¯á»œNG Bá»˜ TRá»°C TUYáº¾N</h2>

 <input id="codeInput" type="text"
  placeholder="Vui lÃ²ng nháº­p mÃ£ há»c viÃªn (VÃ­ dá»¥: HV001, 001, 01...)">

 <button id="loginBtn">ğŸ” ÄÄ‚NG NHáº¬P Há»† THá»NG</button>

 <button id="guestBtn">ğŸ§ª THI THá»¬ KHÃ”NG Cáº¦N ÄÄ‚NG NHáº¬P</button>

 <div class="note">
  Báº¡n chÆ°a cÃ³ mÃ£ há»c viÃªn? <br>
  Báº¡n cÃ³ thá»ƒ <b>thi thá»­</b> Ä‘á»ƒ tráº£i nghiá»‡m. <br>
  Äá»ƒ sá»­ dá»¥ng Ä‘áº§y Ä‘á»§ chá»©c nÄƒng, vui lÃ²ng liÃªn há»‡ quáº£n trá»‹ viÃªn.
 </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain:"thi-luat-giao-thong.firebaseapp.com",
 projectId:"thi-luat-giao-thong"
});
const db=firebase.firestore();

const input=document.getElementById("codeInput");
const loginBtn=document.getElementById("loginBtn");

/* ===== ENTER KEY ===== */
input.addEventListener("keypress",function(e){
 if(e.key==="Enter"){
  login();
 }
});

/* ===== CLICK BUTTON ===== */
loginBtn.onclick=login;

/* ===== LOGIN FUNCTION ===== */
function normalizeCode(val){
 val=val.toUpperCase().replace("HV","");
 val=val.padStart(3,"0");
 return "HV"+val;
}

function login(){
 let raw=input.value.trim();
 if(!raw){alert("Vui lÃ²ng nháº­p mÃ£ há»c viÃªn");return;}

 let code=normalizeCode(raw);

 db.collection("students")
  .where("code","==",code)
  .get()
  .then(snap=>{
   if(snap.empty){
    alert("âŒ MÃ£ há»c viÃªn khÃ´ng tá»“n táº¡i");
    return;
   }
   const s=snap.docs[0].data();
   localStorage.setItem("userType","student");
   localStorage.setItem("studentCode",s.code);
   localStorage.setItem("studentName",s.name);
   localStorage.setItem("unit",s.unit||"");
   window.location.href="exam.html";
  });
}

/* ===== GUEST ===== */
guestBtn.onclick=()=>{
 localStorage.clear();
 localStorage.setItem("userType","guest");
 localStorage.setItem("studentName","KhÃ¡ch");
 window.location.href="exam.html";
