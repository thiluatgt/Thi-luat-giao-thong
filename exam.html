<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜</title>

<style>
body{
 margin:0;
 font-family:Arial;
 background:linear-gradient(135deg,#e8f0ff,#f4f9ff);
}
#header{
 background:linear-gradient(90deg,#1d3557,#264a8a);
 color:white;
 padding:18px 30px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}
#logoutBtn{
 background:#e63946;
 color:white;
 border:none;
 border-radius:10px;
 padding:10px 18px;
 font-size:14px;
 cursor:pointer;
 transition:.3s;
}
#logoutBtn:hover{opacity:.85}

#container{
 max-width:1100px;
 margin:30px auto;
 padding:0 20px;
}
#welcome{
 font-size:22px;
 margin-bottom:25px;
 color:#1d3557;
}
#grid{
 display:grid;
 grid-template-columns:1fr 2fr;
 gap:25px;
}
.box{
 background:white;
 padding:22px;
 border-radius:16px;
 box-shadow:0 8px 25px rgba(0,0,0,.12);
}
.box h3{
 margin-top:0;
 color:#1d3557;
}
.info p{
 margin:10px 0;
}

/* ===== STATISTICS ===== */
.statsRow{
 display:flex;
 gap:18px;
 margin-bottom:22px;
}
.statBox{
 flex:1;
 text-align:center;
 padding:20px;
 border-radius:14px;
 color:white;
}
.statBox:nth-child(1){
 background:linear-gradient(135deg,#457b9d,#1d3557);
}
.statBox:nth-child(2){
 background:linear-gradient(135deg,#2a9d8f,#1b7a6b);
}
.statBox:nth-child(3){
 background:linear-gradient(135deg,#f4a261,#e76f51);
}
.statBox b{
 display:block;
 font-size:26px;
 margin-top:8px;
}

/* ===== ACTION BUTTONS ===== */
.actions{
 display:flex;
 gap:18px;
 justify-content:flex-end;
}
.actionBtn{
 border:none;
 border-radius:14px;
 padding:18px 26px;
 font-size:17px;
 cursor:pointer;
 min-width:230px;
 font-weight:bold;
 transition:.3s;
}
#startBtn{
 background:linear-gradient(135deg,#2a9d8f,#1b7a6b);
 color:white;
 box-shadow:0 6px 18px rgba(42,157,143,.4);
}
#startBtn:hover{
 transform:translateY(-2px);
}
#detailBtn{
 background:linear-gradient(135deg,#457b9d,#1d3557);
 color:white;
 box-shadow:0 6px 18px rgba(69,123,157,.4);
}
#detailBtn:hover{
 transform:translateY(-2px);
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div id="header">
 <div><b>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG</b></div>
 <button id="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>

<!-- ===== MAIN ===== -->
<div id="container">

 <div id="welcome">
  Xin chÃ o, <b id="studentName"></b> ğŸ‘‹
 </div>

 <div id="grid">

  <!-- ===== THÃ”NG TIN Há»ŒC VIÃŠN ===== -->
  <div class="box info">
   <h3>ğŸ“˜ ThÃ´ng tin há»c viÃªn</h3>
   <p><b>MÃ£ há»c viÃªn:</b> <span id="infoCode"></span></p>
   <p><b>Há» vÃ  tÃªn:</b> <span id="infoName"></span></p>
   <p><b>ÄÆ¡n vá»‹:</b> <span id="infoUnit"></span></p>
   <p><b>Tráº¡ng thÃ¡i:</b> <span id="infoStatus">Hoáº¡t Ä‘á»™ng</span></p>
  </div>

  <!-- ===== THá»NG KÃŠ + HÃ€NH Äá»˜NG ===== -->
  <div class="box">
   <h3>ğŸ“Š Thá»‘ng kÃª káº¿t quáº£</h3>

   <div class="statsRow">
    <div class="statBox">
     Sá»‘ lÆ°á»£t thi
     <b id="totalExam">0</b>
    </div>
    <div class="statBox">
     Sá»‘ lÆ°á»£t Ä‘áº¡t
     <b id="passExam">0</b>
    </div>
    <div class="statBox">
     Tá»· lá»‡ Ä‘áº¡t
     <b id="rateExam">0%</b>
    </div>
   </div>

   <div class="actions">
    <button id="detailBtn" class="actionBtn" onclick="viewDetail()">
     ğŸ“„ THá»NG KÃŠ CHI TIáº¾T
    </button>
    <button id="startBtn" class="actionBtn" onclick="startExam()">
     â–¶ LÃ€M BÃ€I KIá»‚M TRA
    </button>
   </div>
  </div>

 </div>

</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain:"thi-luat-giao-thong.firebaseapp.com",
 projectId:"thi-luat-giao-thong"
});
const db=firebase.firestore();

/* ===== LOGIN CHECK ===== */
if(localStorage.getItem("userType")!=="student"){
 alert("Báº¡n chÆ°a Ä‘Äƒng nháº­p");
 window.location.href="index.html";
}

/* ===== USER INFO ===== */
const code=localStorage.getItem("studentCode");
const name=localStorage.getItem("studentName");
const unit=localStorage.getItem("unit")||"";

studentName.innerText=name;
infoCode.innerText=code;
infoName.innerText=name;
infoUnit.innerText=unit;

/* ===== STATISTICS ===== */
db.collection("exam_logs")
 .where("code","==",code)
 .get()
 .then(s=>{
  let total=s.size,pass=0;
  s.forEach(d=>{if(d.data().pass)pass++;});
  totalExam.innerText=total;
  passExam.innerText=pass;
  rateExam.innerText=total?Math.round(pass/total*100)+"%":"0%";
 });

function startExam(){
 window.location.href="test.html";
}
function viewDetail(){
 alert("Trang thá»‘ng kÃª chi tiáº¿t sáº½ Ä‘Æ°á»£c má»Ÿ á»Ÿ bÆ°á»›c tiáº¿p theo");
}
function logout(){
 localStorage.clear();
 window.location.href="index.html";
}
</script>

</body>
</html>
