<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜</title>

<style>
body{
 margin:0;font-family:Arial;background:#eef2f6;
}
#header{
 background:#1d3557;color:white;
 padding:18px 30px;
 display:flex;justify-content:space-between;align-items:center;
}
#logoutBtn{
 background:#e63946;color:white;
 border:none;border-radius:8px;
 padding:10px 16px;
 font-size:14px;cursor:pointer;
}
#container{
 max-width:1100px;
 margin:30px auto;
 padding:0 20px;
}
#welcome{
 font-size:22px;
 margin-bottom:25px;
 color:#1d3557;
}
#grid{
 display:grid;
 grid-template-columns:1fr 2fr;
 gap:25px;
}
.box{
 background:white;
 padding:20px;
 border-radius:12px;
 box-shadow:0 4px 15px rgba(0,0,0,.12);
}
.box h3{
 margin-top:0;
 color:#1d3557;
}
.info p{margin:8px 0;}
.stats{
 display:flex;
 justify-content:space-between;
 align-items:center;
 gap:20px;
}
.statBox{
 flex:1;
 text-align:center;
 background:#f4f6f8;
 padding:18px;
 border-radius:10px;
}
.statBox b{
 font-size:22px;
 color:#1d3557;
}
#startBtn{
 background:#2a9d8f;
 color:white;
 border:none;
 border-radius:12px;
 padding:18px 26px;
 font-size:18px;
 cursor:pointer;
 min-width:260px;
}
#startBtn:hover{opacity:.9;}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div id="header">
 <div><b>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG</b></div>
 <button id="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>

<!-- ===== MAIN ===== -->
<div id="container">

 <div id="welcome">Xin chÃ o, <b id="studentName"></b> ğŸ‘‹</div>

 <div id="grid">

  <!-- ===== INFO ===== -->
  <div class="box info">
   <h3>ğŸ“˜ ThÃ´ng tin há»c viÃªn</h3>
   <p><b>MÃ£ há»c viÃªn:</b> <span id="infoCode"></span></p>
   <p><b>Há» vÃ  tÃªn:</b> <span id="infoName"></span></p>
   <p><b>ÄÆ¡n vá»‹:</b> <span id="infoUnit"></span></p>
   <p><b>Tráº¡ng thÃ¡i:</b> <span id="infoStatus"></span></p>
  </div>

  <!-- ===== STATS + ACTION ===== -->
  <div class="box">
   <h3>ğŸ“Š Thá»‘ng kÃª káº¿t quáº£</h3>

   <div class="stats">
    <div class="statBox">
     <div>Sá»‘ lÆ°á»£t thi</div>
     <b id="totalExam">0</b>
    </div>
    <div class="statBox">
     <div>Sá»‘ lÆ°á»£t Ä‘áº¡t</div>
     <b id="passExam">0</b>
    </div>
    <div class="statBox">
     <div>Tá»· lá»‡ Ä‘áº¡t</div>
     <b id="rateExam">0%</b>
    </div>

    <button id="startBtn" onclick="startExam()">
     â–¶ LÃ€M BÃ€I KIá»‚M TRA
    </button>
   </div>

  </div>

 </div>

</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain:"thi-luat-giao-thong.firebaseapp.com",
 projectId:"thi-luat-giao-thong"
});
const db=firebase.firestore();

/* ===== LOGIN CHECK ===== */
if(localStorage.getItem("userType")!=="student"){
 alert("Báº¡n chÆ°a Ä‘Äƒng nháº­p");
 window.location.href="index.html";
}

/* ===== LOAD INFO ===== */
const code=localStorage.getItem("studentCode");
const name=localStorage.getItem("studentName");
const unit=localStorage.getItem("unit")||"";

studentName.innerText=name;
infoCode.innerText=code;
infoName.innerText=name;
infoUnit.innerText=unit;
infoStatus.innerText="Hoáº¡t Ä‘á»™ng";

/* ===== LOAD STATS ===== */
db.collection("exam_logs")
 .where("code","==",code)
 .get()
 .then(snap=>{
  const total=snap.size;
  let pass=0;
  snap.forEach(d=>{if(d.data().pass)pass++;});
  totalExam.innerText=total;
  passExam.innerText=pass;
  rateExam.innerText=total?Math.round(pass/total*100)+"%":"0%";
 });

/* ===== START ===== */
function startExam(){
 window.location.href="test.html";
}

/* ===== LOGOUT ===== */
function logout(){
 localStorage.clear();
 window.location.href="index.html";
}
</script>

</body>
</html>
