<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜ TRá»°C TUYáº¾N</title>
</head>

<body style="margin:0;font-family:Arial;background:#f2f4f7;">

<!-- HEADER -->
<div style="
  background:#1d3557;
  color:white;
  padding:15px 30px;
  font-size:18px;
">
  Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜ TRá»°C TUYáº¾N
</div>

<!-- MAIN -->
<div style="display:flex;padding:25px;gap:20px;">

  <!-- Cá»˜T TRÃI -->
  <div style="
    width:260px;
    background:white;
    border-radius:8px;
    padding:20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
  ">
    <h3>ğŸ‘¤ ThÃ´ng tin há»c viÃªn</h3>
    <p><b>MÃ£ sá»‘:</b> <span id="hvCode"></span></p>
    <p><b>Há» tÃªn:</b> <span id="hvName"></span></p>
    <p><b>ÄÆ¡n vá»‹:</b> <span id="hvUnit"></span></p>
    <p><b>Tráº¡ng thÃ¡i:</b> <span id="hvStatus"></span></p>
  </div>

  <!-- TRUNG TÃ‚M -->
  <div style="
    flex:1;
    background:white;
    border-radius:8px;
    padding:25px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
  ">
    <h2 id="welcome"></h2>

    <h3>ğŸ“Š Thá»‘ng kÃª káº¿t quáº£</h3>

    <div style="display:flex;gap:20px;margin-top:15px;">
      <div style="flex:1;background:#e9f5ff;padding:15px;border-radius:6px;">
        <b>Tá»•ng lÆ°á»£t kiá»ƒm tra</b>
        <div style="font-size:26px;" id="totalExam">0</div>
      </div>

      <div style="flex:1;background:#e6f7ee;padding:15px;border-radius:6px;">
        <b>Sá»‘ lÆ°á»£t Ä‘áº¡t</b>
        <div style="font-size:26px;" id="passExam">0</div>
      </div>

      <div style="flex:1;background:#fff3cd;padding:15px;border-radius:6px;">
        <b>Tá»· lá»‡ Ä‘áº¡t</b>
        <div style="font-size:26px;" id="rateExam">0%</div>
      </div>
    </div>

    <button onclick="showDetail()" style="
      margin-top:20px;
      padding:10px 18px;
      background:#6c757d;
      color:white;
      border:none;
      border-radius:5px;
      cursor:pointer;
    ">
      ğŸ“„ Chi tiáº¿t káº¿t quáº£
    </button>

    <!-- NÃšT CHá»¨C NÄ‚NG -->
    <div style="margin-top:30px;display:flex;gap:20px;">
      <button onclick="startExam()" style="
        flex:1;
        padding:15px;
        background:#28a745;
        color:white;
        border:none;
        border-radius:6px;
        font-size:16px;
        cursor:pointer;
      ">
        â–¶ TIáº¾P Tá»¤C LÃ€M BÃ€I
      </button>

      <button onclick="logout()" style="
        flex:1;
        padding:15px;
        background:#dc3545;
        color:white;
        border:none;
        border-radius:6px;
        font-size:16px;
        cursor:pointer;
      ">
        â» ÄÄ‚NG XUáº¤T
      </button>
    </div>

  </div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
  authDomain: "thi-luat-giao-thong.firebaseapp.com",
  projectId: "thi-luat-giao-thong"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const code = localStorage.getItem("studentCode");
const type = localStorage.getItem("userType");

if (!code || type !== "student") {
  window.location.href = "index.html";
}

/* LOAD THÃ”NG TIN Há»ŒC VIÃŠN */
db.collection("students").where("code","==",code).get().then(snap=>{
  const s = snap.docs[0].data();
  document.getElementById("hvCode").innerText = s.code;
  document.getElementById("hvName").innerText = s.name;
  document.getElementById("hvUnit").innerText = s.unit || "â€”";
  document.getElementById("hvStatus").innerText = s.status;
  document.getElementById("welcome").innerText =
    "ChÃ o má»«ng há»c viÃªn: " + s.name;
});

/* THá»NG KÃŠ */
db.collection("exam_logs").where("code","==",code).onSnapshot(snap=>{
  let total = snap.size;
  let pass = 0;
  snap.forEach(d=>{
    if (d.data().pass === true) pass++;
  });

  document.getElementById("totalExam").innerText = total;
  document.getElementById("passExam").innerText = pass;
  document.getElementById("rateExam").innerText =
    total === 0 ? "0%" : Math.round(pass/total*100) + "%";
});

/* CHá»¨C NÄ‚NG */
function startExam(){
  window.location.href = "test.html";
}
function showDetail(){
  alert("Trang chi tiáº¿t káº¿t quáº£ sáº½ Ä‘Æ°á»£c má»Ÿ á»Ÿ bÆ°á»›c tiáº¿p theo");
}
function logout(){
  localStorage.clear();
  window.location.href="index.html";
}
</script>

</body>
</html>
