<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜</title>

<style>
body{
 margin:0;
 font-family:Arial;
 background:#eef2f6;
}
#header{
 background:#1d3557;
 color:white;
 padding:15px 30px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}
#logoutBtn{
 background:#e63946;
 color:white;
 border:none;
 padding:8px 16px;
 border-radius:6px;
 cursor:pointer;
 font-size:14px;
}
#container{
 max-width:1200px;
 margin:30px auto;
 padding:0 20px;
}
#title{
 font-size:22px;
 font-weight:bold;
 margin-bottom:20px;
}
#main{
 display:grid;
 grid-template-columns:1.2fr 1.5fr 1fr;
 gap:25px;
}
.box{
 background:white;
 padding:20px;
 border-radius:12px;
 box-shadow:0 5px 20px rgba(0,0,0,.12);
}
.box h3{
 margin-top:0;
 color:#1d3557;
}

/* ===== BUTTON ===== */
#startBtn{
 width:100%;
 height:120px;
 background:#1d3557;
 color:white;
 border:none;
 border-radius:12px;
 font-size:22px;
 font-weight:bold;
 cursor:pointer;
}
#startBtn:hover{
 background:#16324f;
}

/* ===== STATS ===== */
.stat{
 font-size:18px;
 margin:12px 0;
}
.stat span{
 font-weight:bold;
 color:#1d3557;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div id="header">
 <div>ğŸ“˜ Há»† THá»NG KIá»‚M TRA LUáº¬T GIAO THÃ”NG ÄÆ¯á»œNG Bá»˜</div>
 <button id="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>

<!-- ===== CONTENT ===== -->
<div id="container">

 <div id="title">ğŸ‘‹ ChÃ o má»«ng, <span id="studentName"></span></div>

 <div id="main">

  <!-- ===== INFO ===== -->
  <div class="box">
   <h3>ğŸ‘¤ ThÃ´ng tin há»c viÃªn</h3>
   <p><b>MÃ£ há»c viÃªn:</b> <span id="infoCode"></span></p>
   <p><b>Há» vÃ  tÃªn:</b> <span id="infoName"></span></p>
   <p><b>ÄÆ¡n vá»‹:</b> <span id="infoUnit"></span></p>
   <p><b>Tráº¡ng thÃ¡i:</b> <span id="infoStatus"></span></p>
  </div>

  <!-- ===== STATS ===== -->
  <div class="box">
   <h3>ğŸ“Š Thá»‘ng kÃª káº¿t quáº£</h3>
   <div class="stat">Sá»‘ lÆ°á»£t kiá»ƒm tra: <span id="totalExam">0</span></div>
   <div class="stat">Sá»‘ lÆ°á»£t Ä‘áº¡t: <span id="passExam">0</span></div>
   <div class="stat">Tá»· lá»‡ Ä‘áº¡t: <span id="rateExam">0%</span></div>
  </div>

  <!-- ===== ACTION ===== -->
  <div class="box" style="display:flex;align-items:center;">
   <button id="startBtn" onclick="startExam()">
    â–¶ LÃ€M BÃ€I KIá»‚M TRA
   </button>
  </div>

 </div>
</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain:"thi-luat-giao-thong.firebaseapp.com",
 projectId:"thi-luat-giao-thong"
});
const db=firebase.firestore();

/* ===== LOGIN CHECK ===== */
if(localStorage.getItem("userType")!=="student"){
 alert("Báº¡n chÆ°a Ä‘Äƒng nháº­p");
 window.location.href="index.html";
}

const code=localStorage.getItem("studentCode");
const name=localStorage.getItem("studentName");
const unit=localStorage.getItem("unit");

/* ===== DISPLAY INFO ===== */
studentName.innerText=name;
infoCode.innerText=code;
infoName.innerText=name;
infoUnit.innerText=unit;
infoStatus.innerText="Hoáº¡t Ä‘á»™ng";

/* ===== LOAD STATS ===== */
db.collection("exam_logs")
 .where("code","==",code)
 .get()
 .then(snap=>{
  let total=snap.size;
  let pass=0;
  snap.forEach(doc=>{
   if(doc.data().pass) pass++;
  });
  totalExam.innerText=total;
  passExam.innerText=pass;
  rateExam.innerText=total?Math.round(pass/total*100)+"%":"0%";
 });

/* ===== ACTION ===== */
function startExam(){
 window.location.href="test.html";
}
function logout(){
 localStorage.clear();
 window.location.href="index.html";
}
</script>

</body>
</html>
