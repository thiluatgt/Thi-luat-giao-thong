<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ADMIN â€“ Chuáº©n hÃ³a Database</title>
<style>
body{font-family:Arial;background:#f4f6f8;padding:30px;}
.box{background:white;padding:20px;border-radius:12px;max-width:900px;margin:auto;}
button{padding:14px 22px;border:none;border-radius:10px;margin-right:10px;color:white;font-size:15px;cursor:pointer;}
#s{background:#2a9d8f;}#l{background:#457b9d;}
#log{margin-top:15px;background:#111;color:#0f0;padding:15px;height:350px;overflow:auto;}
</style>
</head>
<body>
<div class="box">
<h2>ADMIN â€“ Chuáº©n hÃ³a Database</h2>
<button id="s">Chuáº©n hÃ³a STUDENTS</button>
<button id="l">Chuáº©n hÃ³a EXAM_LOGS</button>
<div id="log"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
 apiKey:"AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain:"thi-luat-giao-thong.firebaseapp.com",
 projectId:"thi-luat-giao-thong"
});
const db=firebase.firestore();
const log=d=>document.getElementById("log").innerHTML+=d+"<br>";

/* STUDENTS: code pháº£i lÃ  NUMBER */
document.getElementById("s").onclick=async()=>{
 const snap=await db.collection("students").get();
 for(const doc of snap.docs){
  const d=doc.data();
  let u={};

  if(typeof d.code==="string"){
   u.code=Number(d.code.replace(/\D/g,""));
  }
  if(d.name && !d.name_lower){
   u.name_lower=d.name.toLowerCase();
  }
  if(!d.status) u.status="Hoáº¡t Ä‘á»™ng";

  if(Object.keys(u).length){
   await db.collection("students").doc(doc.id).update(u);
   log("âœ” "+doc.id+" â†’ "+JSON.stringify(u));
  }
 }
 log("ðŸŽ‰ STUDENTS xong");
}

/* EXAM_LOGS: code lÃ  STRING */
document.getElementById("l").onclick=async()=>{
 const snap=await db.collection("exam_logs").get();
 for(const doc of snap.docs){
  const d=doc.data();
  let u={};

  if(typeof d.code==="number"){
   u.code=String(d.code);
  }

  if(Object.keys(u).length){
   await db.collection("exam_logs").doc(doc.id).update(u);
   log("âœ” "+doc.id+" â†’ "+JSON.stringify(u));
  }
 }
 log("ðŸŽ‰ EXAM_LOGS xong");
}
</script>
</body>
</html>
