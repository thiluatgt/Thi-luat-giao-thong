<script>
const studentCode = localStorage.getItem("studentCode") || "GUEST";
const isStudent = localStorage.getItem("userType") === "student";

function getToday() {
  return new Date().toISOString().split("T")[0];
}

/* ================== Ná»˜P BÃ€I ================== */
function submitExam(correctAnswers, totalQuestions) {

  const score = correctAnswers;
  const pass = score >= 27; // 27/30 Ä‘áº¡t
  const today = getToday();

  // GHI LOG Tá»° Äá»˜NG
  db.collection("exam_logs").add({
    code: studentCode,
    score: score,
    total: totalQuestions,
    pass: pass,
    date: today,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    alert(
      "ğŸ“Š Káº¾T QUáº¢\n" +
      "Sá»‘ cÃ¢u Ä‘Ãºng: " + score + "/" + totalQuestions + "\n" +
      (pass ? "âœ… Äáº T" : "âŒ KHÃ”NG Äáº T")
    );
    window.location.href = "exam.html"; // quay vá» trang há»c viÃªn
  });
}
</script>
