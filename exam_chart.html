<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Biá»ƒu Ä‘á»“ thá»‘ng kÃª - Kiá»ƒm tra luáº­t giao thÃ´ng</title>

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
 margin:0;
 font-family:Arial,Helvetica,sans-serif;
 background:linear-gradient(135deg,#eef3ff,#f9fbff);
}

/* ===== HEADER ===== */
header{
 background:linear-gradient(90deg,#1d3557,#264a8a);
 color:white;
 padding:18px 30px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 box-shadow:0 4px 15px rgba(0,0,0,.25);
}
button{
 border:none;
 border-radius:10px;
 padding:10px 18px;
 font-size:14px;
 cursor:pointer;
}
#backBtn{
 background:#457b9d;
 color:white;
}

/* ===== MAIN ===== */
#container{
 max-width:1100px;
 margin:30px auto;
 padding:0 20px;
}
h2{
 color:#1d3557;
 margin-bottom:25px;
}

/* ===== GRID ===== */
.grid{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:30px;
}
.box{
 background:white;
 padding:25px;
 border-radius:18px;
 box-shadow:0 8px 25px rgba(0,0,0,.12);
}
.box h3{
 margin-top:0;
 margin-bottom:15px;
 color:#1d3557;
 text-align:center;
}

/* ===== FIX CANVAS ===== */
canvas{
 width:100% !important;
 height:320px !important;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<header>
 <b>ğŸ“ˆ BIá»‚U Äá»’ THá»NG KÃŠ Káº¾T QUáº¢ KIá»‚M TRA</b>
 <button id="backBtn" onclick="back()">â¬… Quay láº¡i</button>
</header>

<!-- ===== CONTENT ===== -->
<div id="container">

 <h2 id="studentTitle"></h2>

 <div class="grid">

  <div class="box">
   <h3>ğŸ“Š Sá»‘ lÆ°á»£t kiá»ƒm tra</h3>
   <canvas id="barChart"></canvas>
  </div>

  <div class="box">
   <h3>ğŸ¥§ Tá»· lá»‡ Ä‘áº¡t / khÃ´ng Ä‘áº¡t</h3>
   <canvas id="pieChart"></canvas>
  </div>

 </div>

</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ===== FIREBASE CONFIG ===== */
firebase.initializeApp({
 apiKey: "AIzaSyBGivIEsyBLsLs0CqRvwmwceG26duZbWlM",
 authDomain: "thi-luat-giao-thong.firebaseapp.com",
 projectId: "thi-luat-giao-thong"
});
const db = firebase.firestore();

/* ===== LOGIN CHECK ===== */
if(localStorage.getItem("userType") !== "student"){
 alert("Báº¡n chÆ°a Ä‘Äƒng nháº­p");
 window.location.href = "index.html";
}

/* ===== USER INFO ===== */
const code = localStorage.getItem("studentCode");
const name = localStorage.getItem("studentName");
document.getElementById("studentTitle").innerText =
 "Há»c viÃªn: " + name + " (" + code + ")";

/* ===== BACK ===== */
function back(){
 window.location.href = "exam.html";
}

/* ===== LOAD & DRAW ===== */
db.collection("exam_logs")
 .where("code","==",code)
 .get()
 .then(snapshot=>{
  let total=0, pass=0, fail=0;

  snapshot.forEach(doc=>{
   total++;
   if(doc.data().pass) pass++;
   else fail++;
  });

  drawCharts(total, pass, fail);
 });

function drawCharts(total, pass, fail){

 /* BAR */
 new Chart(document.getElementById("barChart").getContext("2d"),{
  type:"bar",
  data:{
   labels:["Tá»•ng lÆ°á»£t","Äáº¡t","KhÃ´ng Ä‘áº¡t"],
   datasets:[{
    data:[total,pass,fail],
    backgroundColor:["#457b9d","#2a9d8f","#e63946"],
    borderRadius:10
   }]
  },
  options:{
   responsive:true,
   maintainAspectRatio:false,
   plugins:{legend:{display:false}},
   scales:{y:{beginAtZero:true}}
  }
 });

 /* PIE */
 new Chart(document.getElementById("pieChart").getContext("2d"),{
  type:"pie",
  data:{
   labels:["Äáº¡t","KhÃ´ng Ä‘áº¡t"],
   datasets:[{
    data:[pass,fail],
    backgroundColor:["#2a9d8f","#e63946"]
   }]
  },
  options:{
   responsive:true,
   maintainAspectRatio:false
  }
 });

}
</script>

</body>
</html>
